# 1. Digitization of Sound

## 1.1 声音的性质

+ 声音是一种波，可以通过pressure转化为voltage level

## 1.2 Digitization 数字化

+ 模拟信号的数字化有以下两个步骤：
1. 在时间维度上如何进行采样：采样频率、是否均匀等
2. 在选取的时间点上采样后，需要决定赋什么值(量化等级)
> 人耳一般感知20Hz-20kHz的声音
+ 纵轴上很有可能使用非均匀的量化方式

## 1.3 Nyquist Theorem

> 注意区分rate和theorem的概念，往年考试考过
+ Nyquist rate: 要防止失真，采样频率至少得是两倍的最大原始频率（针对数字信号恢复成模拟信号时所需要的频率）
+ Nyquist Theorem: 如果原始信号的最低频为$f1$，最高频率为$f2$，则**采样频率**至少需要$2(f2-f1)$
+ Nyquist Frequency: Half the Nyquist rate

## 1.4 SNR(Signal-to-Noise Ratio)

## 1.5 SQNR

## 1.6 Linear and Nonlinear Quantization

## 1.7 Audio Filtering

## 1.8 Audio Quality versus Data Rate

![[0312_1.png]]

# 2. MIDI(Musical Instruments Digital Interface)

+ 人类可读，与音频文件不同
# 3. Quantization and Transmission of Audio

### Coding of Audio 声音的编码

1. 将声音数字化
2. 换一个表达方式，然后进行量化等
3. 编码

## 3.1 PCM

> 以下过程就是一个PCM
![[0312_2.png]]
> 这是一个更加详细的流程图：
![[0312_3.png]]
+ PCM对语音数据一般采用20kHz的采样频率(因为人的发声频率一般在50-10kHz)
+ 一个点一般采用12bits来存，带宽$12bits\times 20kHz=240kbps$


## 3.2 Differential coding of audio 差分编码

+ 存储相邻信号的差值而不是其本身的值
+ 通过差分编码可以降低信号的熵，从而实现信号的压缩
+ 如下图，经过差分编码之后，信号分布范围变窄，从两个峰变为一个峰，实现了熵的降低，有利于后续的压缩：![[0312_4.png]]
## 3.3 Lossless Predictive Coding

+ 无损预测编码，预测当前值和前一个采样点的值相等，存储预测与实际的差异值e，即用$\hat f_n$表示对$f_n$的预测值，无损预测编码先假定$\hat f_n=f_{n-1}$，然后存储实际值与估计值的error值$e_n=f_n-\hat f_n$
+ 预测公式也可以变得更加复杂，理想情况下是找到一个预测函数，能够使预测值非常接近真实值，这样可以使信号频谱的分布更加窄，从而得到更加低的信息熵(如果存在一个完美的预测函数，则该信号只需要一个值即可存储，这是极端情形)

## 3.4 DPCM

![[0312_5.png]]
+ Decoder获取到的数据已经有损，无法获取真实值，故只能通过**重建值**进行预测
+ 为了能够与解码器保持一致，Encoder也应该通过**重建值**进行预测
+ 差分后的值域实际上变大了，因为会出现负值(**比如0~255的数据，可能出现-255的差分值，于是差分后的值域可能变为-255~255**)，因此需要一个mapping，此过程通过对差分值进行量化实现。以下是一个**量化映射表**的例子，左侧对应区间内的$e_n$被映射至右边的对应值：![[0312_6.png]]
> 根据以上量化表，我将给出一个详细的计算过程来演示DPCM的流程：
+ 使用如下predictor，其中量化部分实际上就是以上给出的量化表：(个人认为PPT上有误，做了一个修正)
$$\tilde f_n=trunc({\tilde f_{n-1}+\tilde f_{n-2}\over 2})$$
$$e_n=f_n-\hat f_{n}$$
$$\tilde e_n=Q[e_n]=16\times trunc((255 + e_n)/16)-256 +8$$
$$\tilde f_n=\hat f_n+\tilde e_n$$
+ 原始数据序列（为了方便计算，添加2个额外的$f=130$）：

| $f_1$ | $f_2$ | $f_3$ | $f_4$ | $f_5$ |
| :---: | :---: | :---: | :---: | :---: |
|  130  |  150  |  140  |  200  |  300  |
1. 预测值$\hat f_1=130$，故误差$e_1=f_1-\hat f_1=0$，通过查表得知量化误差$\tilde e_1=-8$
2. 重建值$\tilde f_1=\hat f_1 + \tilde e_1=130-8=122$，而后可以计算出下一个预测值$\hat f_2={\tilde f_1 +f\over 2}=(122 + 130) / 2=126$
3. 故有$\hat e_2=f_2-\hat f_2=150 - 126=24$，则$\tilde e_2=16\times trunc((255 + 24)/16)-256+8=24$
4. 则重建值$\tilde f_2=\hat f_2+\tilde e_2=126+24=150$，下一个预测值$\hat f_3=trunc({\tilde f_1+\tilde f_2\over 2})=(122+150)/2=136$
5. 以此类推，最后得到下表

|            |  1  |  2  |  3  |  4  |  5  |
| :--------: | :-: | :-: | :-: | :-: | :-: |
|  $\hat f$  | 130 | 126 | 136 | 146 | 172 |
|    $e$     |  0  | 24  |  4  | 54  | 128 |
| $\tilde e$ | -8  | 24  |  8  | 56  | 120 |
| $\tilde f$ | 122 | 150 | 142 | 202 | 292 |

